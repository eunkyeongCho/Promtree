services:
  mongodb:
    image: mongodb/mongodb-community-server:8.0-ubuntu2204
    container_name: mongodb
    restart: always
    ports:
      - ${MONGO_PORT}:27017
    env_file:
      - .env

  qdrant:
    image: qdrant/qdrant:latest
    container_name: qdrant
    ports:
      - "6333:6333"
      - "6334:6334"

  es:
    build:
      context: ./es
      dockerfile: Dockerfile
    container_name: pt-elasticsearch
    ports:
      - "9200:9200"
    environment:
      - discovery.type=single-node
      - xpack.security.enabled=true
      - xpack.security.http.ssl.enabled=false
      - cluster.name=promtree
      - ELASTIC_USERNAME=elastic
      - ELASTIC_PASSWORD=ssafy13s307
    healthcheck:
      test: ["CMD", "curl", "-sf", "-u", "elastic:ssafy13s307", "http://localhost:9200/_cluster/health?pretty"]
      interval: 10s
      timeout: 10s
      retries: 120

  neo4j:
    build:
      context: ./neo4j
      dockerfile: Dockerfile
    container_name: pt-neo4j
    restart: always
    ports:
      - 7474:7474
      - 7687:7687
    environment:
      - NEO4J_ACCEPT_LICENSE_AGREEMENT=yes
      - NEO4J_AUTH=neo4j/ssafy13s307
      - NEO4J_apoc_export_file_enabled=true
      - NEO4J_apoc_import_file_enabled=true
      - NEO4J_apoc_import_file_use__neo4j__config=true
      - NEO4J_PLUGINS=["apoc"]
    healthcheck:
        test: ["CMD", "curl", "-f", "http://localhost:7474"]
        interval: 10s
        timeout: 10s
        retries: 120